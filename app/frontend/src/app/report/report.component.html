<div class="report-page">
  <div class="page-header">
    <h1>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h1>
  </div>

  <div class="report-filters">
    <div class="filter-group">
      <label for="period">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
      <select id="period" [(ngModel)]="selectedPeriod" (change)="loadReport()">
        <option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
        <option value="weekly">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
        <option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
      </select>
    </div>
  </div>

  @if (loading) {
  <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
  } @else if (errorMessage) {
  <div class="error-message">{{ errorMessage }}</div>
  } @else if (report) {
  <div class="report-content">
    <div class="report-summary">
      <div class="summary-card income">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <h3>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
          <p class="amount">‡∏ø{{ formatNumber(report.summary.income) }}</p>
        </div>
      </div>

      <div class="summary-card expense">
        <div class="card-icon">üí∏</div>
        <div class="card-content">
          <h3>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
          <p class="amount">‡∏ø{{ formatNumber(report.summary.expense) }}</p>
        </div>
      </div>

      <div class="summary-card balance">
        <div class="card-icon">üíµ</div>
        <div class="card-content">
          <h3>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
          <p class="amount" [class.negative]="report.summary.balance < 0">
            ‡∏ø{{ formatNumber(report.summary.balance) }}
          </p>
        </div>
      </div>
    </div>

    <div class="report-grid">
      <div class="report-section">
        <h2>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h2>
        @if (report.byCategory && report.byCategory.length > 0) {
        <div class="category-list">
          @for (item of report.byCategory; track item.categoryId) {
          <div class="list-item">
            <div class="item-info">
              <span class="item-icon">{{ item.categoryIcon || 'üìÇ' }}</span>
              <div>
                <span class="item-name">{{ item.categoryName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
                <span class="item-count">{{ item.count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
              </div>
            </div>
            <div class="item-amount">
              <span class="amount">‡∏ø{{ formatNumber(item.total) }}</span>
              <div class="progress-mini">
                <div
                  class="progress-fill-mini"
                  [style.width.%]="getPercentage(item.total, getTotalExpense())"
                ></div>
              </div>
            </div>
          </div>
          }
        </div>
        } @else {
        <p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        }
      </div>

      <div class="report-section">
        <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>
        @if (report.byAccount && report.byAccount.length > 0) {
        <div class="account-list">
          @for (item of report.byAccount; track item.accountId) {
          <div class="list-item">
            <div class="item-info">
              <span class="item-icon">üè¶</span>
              <div>
                <span class="item-name">{{ item.accountName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span>
                <span class="item-count">{{ item.count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
              </div>
            </div>
            <span class="item-amount">‡∏ø{{ formatNumber(item.total) }}</span>
          </div>
          }
        </div>
        } @else {
        <p class="empty-state">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        }
      </div>
    </div>

    @if (report.budgetInfo) {
    <div class="budget-section">
      <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</h2>
      <div class="budget-overview">
        <div class="budget-stat">
          <span class="label">‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
          <span class="value">‡∏ø{{ formatNumber(report.budgetInfo.totalBudget) }}</span>
        </div>
        <div class="budget-stat">
          <span class="label">‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ</span>
          <span class="value spent">‡∏ø{{ formatNumber(report.budgetInfo.totalSpent) }}</span>
        </div>
        <div class="budget-stat">
          <span class="label">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
          <span class="value" [class.negative]="report.budgetInfo.remaining < 0">
            ‡∏ø{{ formatNumber(report.budgetInfo.remaining) }}
          </span>
        </div>
        <div class="budget-stat">
          <span class="label">‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</span>
          <span class="value percentage">{{ report.budgetInfo.percentage.toFixed(1) }}%</span>
        </div>
      </div>
      <div class="budget-progress-bar">
        <div
          class="budget-progress-fill"
          [style.width.%]="Math.min(report.budgetInfo.percentage, 100)"
          [class.warning]="report.budgetInfo.percentage >= 80"
          [class.exceeded]="report.budgetInfo.percentage > 100"
        ></div>
      </div>
    </div>
    } @if (report.trends && report.trends.length > 0) {
    <div class="trends-section">
      <h2>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
      <div class="trends-chart">
        @for (trend of report.trends; track trend._id) {
        <div class="trend-bar">
          <div class="trend-label">{{ trend._id }}</div>
          <div class="trend-bars">
            <div class="trend-income" [style.height.px]="getTrendHeight(trend.income)">
              <span class="trend-value">‡∏ø{{ formatShort(trend.income) }}</span>
            </div>
            <div class="trend-expense" [style.height.px]="getTrendHeight(trend.expense)">
              <span class="trend-value">‡∏ø{{ formatShort(trend.expense) }}</span>
            </div>
          </div>
          <div class="trend-legend">
            <span class="legend-income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
            <span class="legend-expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <div class="report-info">
      <p>
        <strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</strong> {{ formatDate(report.startDate) }} -
        {{ formatDate(report.endDate) }}
      </p>
      <p><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</strong> {{ formatDate(currentDate) }}</p>
    </div>
  </div>
  }

  <div class="page-footer">
    <a routerLink="/dashboard" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>
</div>
