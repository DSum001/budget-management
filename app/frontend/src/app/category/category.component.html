<div class="category-page">
  <div class="page-header">
    <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h1>
    <button class="btn-primary" (click)="showForm = !showForm">
      {{ showForm ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà' }}
    </button>
  </div>

  @if (errorMessage) {
  <div class="error-message">{{ errorMessage }}</div>
  } @if (showForm) {
  <div class="category-form">
    <h2>{{ editingCategory ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà' : '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà' }}</h2>
    <form (ngSubmit)="saveCategory()">
      <div class="form-row">
        <div class="form-group">
          <label for="name">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="currentCategory.name"
            name="name"
            required
            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"
          />
        </div>

        <div class="form-group">
          <label for="type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
          <select id="type" [(ngModel)]="currentCategory.type" name="type" required>
            <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
            <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="icon">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Emoji)</label>
          <input
            type="text"
            id="icon"
            [(ngModel)]="currentCategory.icon"
            name="icon"
            placeholder="üçî"
            maxlength="2"
          />
        </div>

        <div class="form-group">
          <label for="color">‡∏™‡∏µ</label>
          <input type="color" id="color" [(ngModel)]="currentCategory.color" name="color" />
        </div>
      </div>

      <div class="form-group">
        <label for="description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
        <textarea
          id="description"
          [(ngModel)]="currentCategory.description"
          name="description"
          rows="2"
          placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
        ></textarea>
      </div>

      <div class="form-group checkbox">
        <label>
          <input type="checkbox" [(ngModel)]="currentCategory.isActive" name="isActive" />
          <span>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span>
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="loading">
          {{ loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' }}
        </button>
        <button type="button" class="btn-secondary" (click)="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div>
  } @if (loading && categories.length === 0) {
  <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
  } @else if (!loading && categories.length === 0) {
  <div class="empty-state">
    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
    <p class="hint">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
  </div>
  } @else if (categories.length > 0) {
  <div class="categories-tabs">
    <button class="tab-button" [class.active]="activeTab === 'all'" (click)="activeTab = 'all'">
      ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ categories.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'income'"
      (click)="activeTab = 'income'"
    >
      ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ({{ incomeCategories.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'expense'"
      (click)="activeTab = 'expense'"
    >
      ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ({{ expenseCategories.length }})
    </button>
  </div>

  <div class="categories-grid">
    @for (category of filteredCategories; track category._id) {
    <div class="category-card" [class.inactive]="!category.isActive">
      <div class="category-header">
        <div class="category-icon-wrapper" [style.background-color]="category.color || '#f0f0f0'">
          <span class="category-icon">{{ category.icon || 'üìÇ' }}</span>
        </div>
        <div class="category-info">
          <h3>{{ category.name }}</h3>
          <span class="category-type" [class.income]="category.type === 'income'">
            {{ category.type === 'income' ? '‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢' }}
          </span>
        </div>
        @if (!category.isActive) {
        <span class="badge inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
        }
      </div>

      @if (category.description) {
      <p class="category-description">{{ category.description }}</p>
      }

      <div class="category-actions">
        <button class="btn-edit" (click)="editCategory(category)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn-delete" (click)="deleteCategory(category._id!)">‡∏•‡∏ö</button>
      </div>
    </div>
    }
  </div>
  }

  <div class="page-footer">
    <a routerLink="/dashboard" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>
</div>
