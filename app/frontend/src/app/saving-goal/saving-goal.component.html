<div class="goal-page">
  <div class="page-header">
    <h1>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h1>
    <button class="btn-primary" (click)="showForm = !showForm">
      {{ showForm ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' : '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' }}
    </button>
  </div>

  @if (errorMessage) {
  <div class="error-message">{{ errorMessage }}</div>
  } @if (showForm) {
  <div class="goal-form">
    <h2>{{ editingGoal ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' : '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà' }}</h2>
    <form (ngSubmit)="saveGoal()">
      <div class="form-group">
        <label for="name">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ *</label>
        <input
          type="text"
          id="name"
          [(ngModel)]="currentGoal.name"
          name="name"
          required
          placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå, ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß, ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="targetAmount">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏ø) *</label>
          <input
            type="number"
            id="targetAmount"
            [(ngModel)]="currentGoal.targetAmount"
            name="targetAmount"
            required
            step="0.01"
            placeholder="0.00"
          />
        </div>

        <div class="form-group">
          <label for="currentAmount">‡∏≠‡∏≠‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏ø)</label>
          <input
            type="number"
            id="currentAmount"
            [(ngModel)]="currentGoal.currentAmount"
            name="currentAmount"
            step="0.01"
            placeholder="0.00"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="targetDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÄ‡∏õ‡πâ‡∏≤</label>
          <input
            type="date"
            id="targetDate"
            [(ngModel)]="currentGoal.targetDate"
            name="targetDate"
          />
        </div>

        <div class="form-group">
          <label for="priority">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label>
          <select id="priority" [(ngModel)]="currentGoal.priority" name="priority">
            <option value="low">‡∏ï‡πà‡∏≥</option>
            <option value="medium">‡∏Å‡∏•‡∏≤‡∏á</option>
            <option value="high">‡∏™‡∏π‡∏á</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
        <textarea
          id="description"
          [(ngModel)]="currentGoal.description"
          name="description"
          rows="3"
          placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
        ></textarea>
      </div>

      <div class="form-group checkbox">
        <label>
          <input type="checkbox" [(ngModel)]="currentGoal.isActive" name="isActive" />
          <span>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span>
        </label>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="loading">
          {{ loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' }}
        </button>
        <button type="button" class="btn-secondary" (click)="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </form>
  </div>
  } @if (loading && goals.length === 0) {
  <div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
  } @else if (!loading && goals.length === 0) {
  <div class="empty-state">
    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</p>
    <p class="hint">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</p>
  </div>
  } @else if (goals.length > 0) {
  <div class="goals-summary">
    <div class="summary-card">
      <h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <p class="count">{{ activeGoals.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
    </div>
    <div class="summary-card">
      <h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏ß‡∏°</h3>
      <p class="amount">‡∏ø{{ formatNumber(totalTarget) }}</p>
    </div>
    <div class="summary-card">
      <h3>‡∏≠‡∏≠‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</h3>
      <p class="amount saved">‡∏ø{{ formatNumber(totalSaved) }}</p>
    </div>
    <div class="summary-card">
      <h3>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
      <p class="amount remaining">‡∏ø{{ formatNumber(totalTarget - totalSaved) }}</p>
    </div>
  </div>

  <div class="goals-grid">
    @for (goal of goals; track goal._id) {
    <div
      class="goal-card"
      [class.inactive]="!goal.isActive"
      [class.completed]="getProgressPercentage(goal) >= 100"
    >
      <div class="goal-header">
        <div class="goal-info">
          <h3>{{ goal.name }}</h3>
          @if (goal.priority) {
          <span class="priority-badge" [class]="goal.priority">
            {{ getPriorityLabel(goal.priority) }}
          </span>
          }
        </div>
        <div class="goal-status">
          @if (!goal.isActive) {
          <span class="badge inactive">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
          } @else if (getProgressPercentage(goal) >= 100) {
          <span class="badge completed">‡∏ö‡∏£‡∏£‡∏•‡∏∏‡πÅ‡∏•‡πâ‡∏ß üéâ</span>
          }
        </div>
      </div>

      @if (goal.description) {
      <p class="goal-description">{{ goal.description }}</p>
      }

      <div class="goal-progress">
        <div class="progress-info">
          <span
            >‡∏ø{{ formatNumber(goal.currentAmount) }} / ‡∏ø{{ formatNumber(goal.targetAmount) }}</span
          >
          <span class="percentage">{{ getProgressPercentage(goal).toFixed(1) }}%</span>
        </div>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="Math.min(getProgressPercentage(goal), 100)"
            [class.completed]="getProgressPercentage(goal) >= 100"
          ></div>
        </div>
      </div>

      <div class="goal-details">
        <div class="detail-row">
          <span class="label">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
          <span class="value" [class.completed]="goal.targetAmount - goal.currentAmount <= 0">
            ‡∏ø{{ formatNumber(Math.max(0, goal.targetAmount - goal.currentAmount)) }}
          </span>
        </div>
        @if (goal.targetDate) {
        <div class="detail-row">
          <span class="label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤:</span>
          <span class="value" [class.warning]="isNearDeadline(goal.targetDate)">
            {{ formatDate(goal.targetDate) }}
            @if (getDaysRemaining(goal.targetDate) > 0) { (‡∏≠‡∏µ‡∏Å
            {{ getDaysRemaining(goal.targetDate) }} ‡∏ß‡∏±‡∏ô) }
          </span>
        </div>
        @if (getDaysRemaining(goal.targetDate) > 0 && getProgressPercentage(goal) < 100) {
        <div class="detail-row">
          <span class="label">‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô:</span>
          <span class="value highlight"> ‡∏ø{{ formatNumber(getDailyTarget(goal)) }} </span>
        </div>
        } }
      </div>

      <div class="goal-actions">
        <button class="btn-add" (click)="showAddMoneyDialog(goal)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
        <button class="btn-edit" (click)="editGoal(goal)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
        <button class="btn-delete" (click)="deleteGoal(goal._id!)">‡∏•‡∏ö</button>
      </div>
    </div>
    }
  </div>
  } @if (showAddMoney && selectedGoal) {
  <div class="modal-overlay" (click)="closeAddMoneyDialog()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°</h2>
      <p class="modal-goal-name">{{ selectedGoal.name }}</p>
      <form (ngSubmit)="addMoney()">
        <div class="form-group">
          <label for="amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ø)</label>
          <input
            type="number"
            id="amount"
            [(ngModel)]="addAmount"
            name="amount"
            required
            step="0.01"
            min="0"
            placeholder="0.00"
            autofocus
          />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="loading">
            {{ loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' }}
          </button>
          <button type="button" class="btn-secondary" (click)="closeAddMoneyDialog()">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <div class="page-footer">
    <a routerLink="/dashboard" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>
</div>
